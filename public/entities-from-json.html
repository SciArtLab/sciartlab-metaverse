<!--

 
 "*------------------------------------------------------------------------------*"
 "|                                                                              |"
 "|   ███████╗ ██████╗██╗ █████╗ ██████╗ ████████╗    ██╗      █████╗ ██████╗    |"
 "|   ██╔════╝██╔════╝██║██╔══██╗██╔══██╗╚══██╔══╝    ██║     ██╔══██╗██╔══██╗   |"
 "|   ███████╗██║     ██║███████║██████╔╝   ██║       ██║     ███████║██████╔╝   |"
 "|   ╚════██║██║     ██║██╔══██║██╔══██╗   ██║       ██║     ██╔══██║██╔══██╗   |"
 "|   ███████║╚██████╗██║██║  ██║██║  ██║   ██║       ███████╗██║  ██║██████╔╝   |"
 "|   ╚══════╝ ╚═════╝╚═╝╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝       ╚══════╝╚═╝  ╚═╝╚═════╝    |"
 "|                                                                              |"
 "|                      SciartLab Metaverse Components                          |"
 "|                                                                              |"
 "|                    **********  VR Experiments *******                        |"
 "|                                                                              |"
 "|                     Twitter:  @dgrmunch  | @sciartlab                        |"
 "|                     Website:  http://www.sciartlab.com]                      |"
 "|                                                                              |"
 "*------------------------------------------------------------------------------*"

* Description: 

Loading entities from an external JSON file. It can be used to create menus
or dynamic visualizations based on REST APIs and external sources.
Initially I had this in mind as a way to access the SciArt Lab projects (information, 
pictures, links) directly from the Metaverse. But it will be used for different 
purposes.

-->

<!-- JAVASCRIPT -->
<script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
<script src="https://sciartlab-vr.glitch.me/js/sciart-lab-vr-basic.js"></script>

<script>

  //This will be used as a callback function after calling a REST API
  function processJson(json){
    var obj = JSON.parse(json);

    //We select the scene to append the new entities
    var sceneEl = document.querySelector('a-scene');
    
    //We create a reference entity with absolute coordinates
    var refEl = document.createElement('a-entity');
    refEl.setAttribute('position',  {y: 1, x: -9, z: -5});
    refEl.setAttribute('id', 'refEl');
    
    //Append the reference entity to the scene
    sceneEl.appendChild(refEl);

    //We will load the research lines of the SciArt Lab create the menu elements    
    for(var i = 0; i< obj.research_lines.length; i++){

      //We create one entity for each research line
      var entityEl = document.createElement('a-entity');
      entityEl.setAttribute('id', 'research_line_'+i);

      //These entities will be cubes (boxes)
      entityEl.setAttribute('geometry', {
              primitive: 'box',
              height: 1,
              width: 1
            });

      //The texture of each box will be the image_url specified in the JSON
      //IMPORTANT: Due to the CORS policy use resources URLs with HTTPS
      entityEl.setAttribute('material', {src: obj.research_lines[i].image_url});

      //The position in the 3D space will be relative to the previous entity of ref.
      entityEl.setAttribute('position',  {y: 0, x: (i * 3) + 5, z: 0});

      //In case there is a url we attach the href and the onclick event to open
      //the link when the user is looking to the entity
      if(obj.research_lines[i].url != '' && obj.research_lines[i].url != undefined){
        entityEl.setAttribute('href',  obj.research_lines[i].url);
        entityEl.setAttribute('onclick', "goToPage('"+entityEl.getAttribute('href')+"')");
      }

      //TODO HoverLink and add context information
      entityEl.setAttribute('mouseenter', "hoverLink()");

      //Append the new entity to the reference entity
      refEl.appendChild(entityEl);
      
      //In case there is any name, add it on the top of the link.
      if(obj.research_lines[i].name != '' && obj.research_lines[i].name != undefined){
        
        var nameEl = document.createElement('a-text');
        
        nameEl.setAttribute('width', '3');
        nameEl.setAttribute('align', 'center');
        nameEl.setAttribute('color', 'white');
        nameEl.setAttribute('value', obj.research_lines[i].name);
        nameEl.setAttribute('position',  {y: 1, x: 0, z: 0}); //Relative to the box
        entityEl.appendChild(nameEl);

      }

    }

  }

  //Load the JSON with the information of the new entities
  httpGet("https://raw.githubusercontent.com/SciArtLab/json-data-repo/master/sciartlab/summary.json",processJson);

</script>
<!-- END JAVASCRIPT -->

<!-- A-FRAME SCENE -->
<a-scene>

  <!-- Add assets-->
  <a-assets>
    <a-asset id="floorImg" src="https://cdn.glitch.com/b870d9ec-1139-44f9-b462-223e4a2c74e7%2Ffloor.jpg?1490307896453"></a-asset>
  </a-assets>

  <!-- Add sky to the scene -->
  <a-sky color="black"></a-sky>
  
  <!-- Add lights -->
  <a-light type="point" color="purple" intensity="1" position="3 1 -3" rotation="0 0 0" scale="1 1 1" visible="true" light="type:point;color:purple;intensity:1"></a-light>    

  <!-- Add floor to the scene -->
  <a-plane material="src:#floorImg" rotation="-90 0 0" height="100" width="100" position="0 0 0" scale="1 1 1"></a-plane>

  <!--Camera controls-->
  <a-camera >
    <!-- Add gaze cursor to control the scene without external controllers  -->
    <a-entity cursor="fuse: true;fuseTimeout: 2000" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.1; radiusOuter: 0.11" material="color: lightgreen; shader: flat">

        <!-- Add gaze cursor to control the scene without external controllers  -->
        <a-animation begin="click" easing="ease-in" attribute="scale" dur="1000" fill="forwards" from="0.1 0.1 0.1" to="2 2 2"></a-animation>
        <a-animation begin="fusing" easing="ease-in" attribute="scale" fill="backwards" from="2 2 2" to="0.1 0.1 0.1" dur="1000"></a-animation>

    </a-entity>
  </a-camera>

</a-scene>
<!-- END A-FRAME SCENE -->