<!--

 
 "*------------------------------------------------------------------------------*"
 "|                                                                              |"
 "|   ███████╗ ██████╗██╗ █████╗ ██████╗ ████████╗    ██╗      █████╗ ██████╗    |"
 "|   ██╔════╝██╔════╝██║██╔══██╗██╔══██╗╚══██╔══╝    ██║     ██╔══██╗██╔══██╗   |"
 "|   ███████╗██║     ██║███████║██████╔╝   ██║       ██║     ███████║██████╔╝   |"
 "|   ╚════██║██║     ██║██╔══██║██╔══██╗   ██║       ██║     ██╔══██║██╔══██╗   |"
 "|   ███████║╚██████╗██║██║  ██║██║  ██║   ██║       ███████╗██║  ██║██████╔╝   |"
 "|   ╚══════╝ ╚═════╝╚═╝╚═╝  ╚═╝╚═╝  ╚═╝   ╚═╝       ╚══════╝╚═╝  ╚═╝╚═════╝    |"
 "|                                                                              |"
 "|                      SciartLab Metaverse Components                          |"
 "|                                                                              |"
 "|                    **********  VR Experiments *******                        |"
 "|                                                                              |"
 "|                     Twitter:  @dgrmunch  | @sciartlab                        |"
 "|                     Website:  http://www.sciartlab.com]                      |"
 "|                                                                              |"
 "*------------------------------------------------------------------------------*"

Description: Instrument components with ios compatibility
//TODO: Upload and pin all resources in IPFS
-->
<html>
<head>
  
  <title>SciArtLab Sound VR experiments</title>
  <script src="https://aframe.io/releases/0.7.0/aframe.min.js"></script>
  <script src="https://sciartlab-vr.glitch.me/js/sciart-aframe-components.js"></script>
  <script src="js/howler.js"></script>

  <script>
    
    //SOUND SPRITE
    var sound = new Howl({
      src: ['https://ia600704.us.archive.org/16/items/AlphabetSongSimplePianoSolo/TinwkleTwinklePianoSoloSimple.mp3'],
      volume: 1,
      sprite: 
            {
             sound_1: [0, 300],
             sound_2: [1200, 300],
             sound_3: [3000, 300]
            }
      });
  
    //KEY-COMPONENT MAPPING
    
    //KEYBOARD NUMBERS
    var map = {};
    map['49'] = 'box_1';
    map['50'] = 'box_2';
    map['51'] = 'box_3';
    map['52'] = 'box_4';
    map['53'] = 'box_5';
    map['54'] = 'box_6';
    map['55'] = 'box_7';
    map['56'] = 'box_8';
    map['57'] = 'box_9';
    
    //MAKEY MAKEY (TESTNG)
    map['87'] = 'box_1';
    map['65'] = 'box_2';
    map['68'] = 'box_3';
    
    //KEY LISTENERS  
    document.onkeydown = function(e) {  
        console.log(e.keyCode + " - " +map[e.keyCode]);
        if(map[e.keyCode] != undefined)
         document.getElementById(map[e.keyCode]).click();
    }
    
    //LOGIC
    function playSound(soundId){
      console.log(soundId);
      //Testing oscillator
  // var context = new webkitAudioContext();
    var oscillator = window.audioContext.createOscillator();
    oscillator.type = 0; // -> sine 
    oscillator.frequency.value = 200;
    oscillator.connect(window.audioContext.destination);
    oscillator.start(0);

      sound.play(soundId);  
    }
    
    
// Fix iOS Audio Context by Blake Kus https://gist.github.com/kus/3f01d60569eeadefe3a1
// MIT license
(function() {
	window.AudioContext = window.AudioContext || window.webkitAudioContext;
	if (window.AudioContext) {
		window.audioContext = new window.AudioContext();
	}
	var fixAudioContext = function (e) {
		if (window.audioContext) {
			// Create empty buffer
			var buffer = window.audioContext.createBuffer(1, 1, 22050);
			var source = window.audioContext.createBufferSource();
			source.buffer = buffer;
			// Connect to output (speakers)
			source.connect(window.audioContext.destination);
			// Play sound
			if (source.start) {
				source.start(0);
			} else if (source.play) {
				source.play(0);
			} else if (source.noteOn) {
				source.noteOn(0);
			}
		}
		// Remove events
		document.removeEventListener('touchstart', fixAudioContext);
		document.removeEventListener('touchend', fixAudioContext);
	};
	// iOS 6-8
	document.addEventListener('touchstart', fixAudioContext);
	// iOS 9
	document.addEventListener('touchend', fixAudioContext);
})();
    
  </script>

</head>

<body>

  <a-scene>
    
      <!-- ASSETS -->
       <a-assets>
       
         <!-- MIXINS -->
        <a-mixin id="touched" dur="100" attribute="scale" begin="click" fill="forwards" to="1 1.9 1"></a-mixin>
      
      </a-assets>
    
      <!-- CAMERA -->
      <a-entity id="player" networked="template:#avatar-template;showLocalTemplate:false;" camera="userHeight: 2.6" universal-controls="movementControls: checkpoint" checkpoint-controls="mode: animate">
        <a-entity cursor="fuse: true;fuseTimeout: 0.001" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.1; radiusOuter: 0.11" material="color: white; shader: flat">
        </a-entity>
      </a-entity>

      <!-- SCENE CONTENT-->
    
      <!-- BACKGROUND -->
      <a-sky color="pink"></a-sky>
    
      <a-box id="box_1" color="red" position="-1 1 2" onclick="playSound('sound_1');"> 
          <a-animation mixin="touched"></a-animation>
      </a-box>
      <a-box id="box_2" color="green" position="0.2 1 2" onclick="playSound('sound_2');">
        <a-animation mixin="touched"></a-animation>
      </a-box>
      <a-box id="box_3" color="blue" position="1.4 1 2" onclick="playSound('sound_3');">
        <a-animation mixin="touched"></a-animation>
      </a-box>
  
  </a-scene>

</body>
</html>